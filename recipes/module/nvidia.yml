# COPY FROM WAYBLUE: https://github.com/wayblueorg/wayblue/blob/live/recipes/common/nvidia-modules.yml

modules:
  - type: containerfile
    snippets:
      - COPY --from=ghcr.io/ublue-os/akmods-nvidia:main-41 /rpms/ /tmp/rpms
      - RUN find /tmp/rpms
      - RUN rpm-ostree install /tmp/rpms/ublue-os/ublue-os-nvidia*.rpm
      - RUN sed -i '0,/enabled=0/{s/enabled=0/enabled=1/}' /etc/yum.repos.d/nvidia-container-toolkit.repo
      - RUN sed -i '0,/enabled=0/{s/enabled=0/enabled=1\npriority=90/}' /etc/yum.repos.d/negativo17-fedora-nvidia.repo   
  - type: script
    scripts:
      - installnvidiatoolkitpolicy.sh
      - removeunusedrepos.sh
      - setearlyloading.sh
      - setdrmvariables.sh